<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bakecart Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    body { background:#f5f5f5; font-family:'Roboto',sans-serif; color:#333; padding:20px; margin:0; }
    h1 { text-align:center; margin-bottom:30px; font-weight:700; color:#2c3e50; }
    .container { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; }
    section { background:#fff; border-radius:8px; padding:20px; box-shadow:0 2px 6px rgba(0,0,0,0.1); flex:1; min-width:300px; max-width:700px; }
    table { width:100%; border-collapse:collapse; margin-bottom:15px; }
    th, td { padding:10px; text-align:left; border-bottom:1px solid #ddd; }
    th { background:#ecf0f1; font-weight:500; }
    tr:hover { background:#f9f9f9; }
    button { background:#3498db; color:#fff; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; transition:0.2s; margin-right:5px; font-size:0.9em; }
    button:hover { background:#2980b9; }
    input, select { padding:6px; border-radius:4px; border:1px solid #ccc; width:100%; box-sizing:border-box; }
    button[type="submit"] { margin-top:5px; width:fit-content; }
    .message { text-align:center; margin-bottom:15px; font-weight:500; min-height:24px; color:#27ae60; }
    .total { font-weight:600; margin-top:10px; }
    .inline-input { width:80px; }
    .status-badge { padding: 3px 6px; border-radius: 5px; color:#fff; font-weight:bold; font-size:0.8em; margin-right:5px; }
    .status-badge.pending { background:#f1c40f; }
    .status-badge.completed { background:#2ecc71; }
    .status-badge.cancelled { background:#e74c3c; }

    /* Pagination buttons */
    #products-pagination button,
    #orders-pagination button { margin:2px; }

    /* Mobile Responsive */
    @media (max-width:900px){
        .container { flex-direction:column; align-items:center; }
        table { display:block; overflow-x:auto; white-space:nowrap; }
        th, td { min-width:120px; }
        input, select, button { font-size:0.9em; }
        h1 { font-size:1.5em; }
    }

    @media (max-width:500px){
        section { padding:15px; }
        button { padding:5px 8px; font-size:0.85em; }
        input, select { font-size:0.85em; }
    }
    <style>
.titlebar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    background: linear-gradient(90deg, #34495e, #2c3e50);
    color: #ecf0f1;
    font-weight: 700;
    font-size: 1.8em;
    padding: 15px 0;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    text-align: center;
}
</style>
</style>
</head>
<body>

<h1>Bakecart Admin Dashboard</h1>
<div id="message" class="message"></div>

<div class="container">
    <!-- PRODUCTS -->
    <section>
        <h2>Products</h2>
        <input type="text" id="product-search" placeholder="Search Products...">
        <button onclick="bulkDeleteProducts()">Delete Selected</button>
        <table id="product-table">
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all-products"></th>
                    <th>ID</th><th>Name</th><th>Price</th><th>Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div id="products-pagination"></div>

        <h3>Add Product</h3>
        <form id="add-product-form">
            <input type="text" id="product-name" placeholder="Product Name" required>
            <input type="number" id="product-price" placeholder="Product Price" required min="1">
            <button type="submit">Add Product</button>
        </form>
    </section>

    <!-- ORDERS -->
    <section>
        <h2>Orders</h2>
        <div style="margin-bottom:10px; display:flex; flex-wrap:wrap; gap:5px;">
            <select id="order-sort">
                <option value="latest">Latest</option>
                <option value="total-asc">Total ↑</option>
                <option value="total-desc">Total ↓</option>
                <option value="status">Status</option>
            </select>
            <button onclick="filterOrders('All')">All</button>
            <button onclick="filterOrders('Pending')">Pending</button>
            <button onclick="filterOrders('Completed')">Completed</button>
            <button onclick="filterOrders('Cancelled')">Cancelled</button>
            <button onclick="bulkDeleteOrders()">Delete Selected</button>
        </div>
        <table id="order-table">
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all-orders"></th>
                    <th>Order ID</th><th>Product</th><th>Qty</th><th>Total</th><th>Status</th><th>Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div id="orders-pagination"></div>
        <p class="total">Total Amount: ₹<span id="total-amount">0</span></p>

        <h3>Create Order</h3>
        <form id="add-order-form">
            <select id="order-product-select" required>
                <option value="">Select Product</option>
            </select>
            <input type="number" id="order-quantity" placeholder="Quantity" required min="1">
            <button type="submit">Place Order</button>
        </form>
    </section>
</div>

<script>
const PRODUCT_URL = "https://bakecart-product-service.onrender.com/products";
const ORDER_URL   = "https://bakecart-order-service.onrender.com/orders";

const productTable = document.querySelector('#product-table tbody');
const orderTable = document.querySelector('#order-table tbody');
const addProductForm = document.getElementById('add-product-form');
const addOrderForm = document.getElementById('add-order-form');
const orderProductSelect = document.getElementById('order-product-select');
const messageDiv = document.getElementById('message');
const totalAmountSpan = document.getElementById('total-amount');
const productSearch = document.getElementById('product-search');
const orderSort = document.getElementById('order-sort');

let currentProductPage=1, currentOrderPage=1, ITEMS_PER_PAGE=10;

function showMessage(msg,color='green'){messageDiv.textContent=msg; messageDiv.style.color=color; setTimeout(()=>messageDiv.textContent='',3000);}

async function apiCall(url, method='GET', data=null){
    const options={method,headers:{'Content-Type':'application/json'}};
    if(data) options.body=JSON.stringify(data);
    const res = await fetch(url,options);
    const resData = await res.json();
    if(!res.ok) throw new Error(resData.error||'API error');
    return resData;
}

// --- PRODUCTS ---
async function loadProducts(page=1){
    currentProductPage=page;
    let products=await apiCall(PRODUCT_URL);
    const start=(page-1)*ITEMS_PER_PAGE;
    const paginated=products.slice(start,start+ITEMS_PER_PAGE);

    productTable.innerHTML='';
    paginated.forEach(p=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
            <td><input type="checkbox" class="product-checkbox"></td>
            <td>${p.id}</td>
            <td contenteditable="true" class="inline-input" onblur="editProduct(${p.id}, 'name', this.textContent)">${p.name}</td>
            <td contenteditable="true" class="inline-input" onblur="editProduct(${p.id}, 'price', this.textContent)">₹${p.price}</td>
            <td><button onclick="deleteProduct(${p.id})">Delete</button></td>
        `;
        productTable.appendChild(tr);
    });
    renderPagination(products.length,page,'products');
    loadProductOptions(products);
}

function renderPagination(totalItems,currentPage,type){
    const container=document.getElementById(type==='products'?'products-pagination':'orders-pagination');
    container.innerHTML='';
    const totalPages=Math.ceil(totalItems/ITEMS_PER_PAGE);
    if(currentPage>1){const btn=document.createElement('button'); btn.textContent='Prev'; btn.onclick=()=>type==='products'?loadProducts(currentPage-1):loadOrders(currentPage-1); container.appendChild(btn);}
    if(currentPage<totalPages){const btn=document.createElement('button'); btn.textContent='Next'; btn.onclick=()=>type==='products'?loadProducts(currentPage+1):loadOrders(currentPage+1); container.appendChild(btn);}
}

async function loadProductOptions(products){
    orderProductSelect.innerHTML='<option value="">Select Product</option>';
    products.forEach(p=>{
        const option=document.createElement('option');
        option.value=p.id;
        option.textContent=`${p.name} - ₹${p.price}`;
        orderProductSelect.appendChild(option);
    });
}

async function addProduct(e){e.preventDefault();
    const name=document.getElementById('product-name').value.trim();
    let price=parseFloat(document.getElementById('product-price').value);
    if(price<=0){showMessage("Price must be positive","red"); return;}
    try{await apiCall(PRODUCT_URL,'POST',{name,price}); addProductForm.reset(); showMessage("Product added successfully"); loadProducts(currentProductPage);}
    catch(err){showMessage(err.message,'red');}
}

async function deleteProduct(id){if(!confirm('Are you sure you want to delete this product?')) return;
    try{await apiCall(`${PRODUCT_URL}/${id}`,'DELETE'); showMessage("Product deleted"); loadProducts(currentProductPage);}
    catch(err){showMessage(err.message,'red');}
}

async function editProduct(id,field,value){
    value=field==='price'?parseFloat(value.replace('₹','')):value.trim();
    if(field==='price'&&value<=0){showMessage('Price must be positive','red'); return;}
    try{await apiCall(`${PRODUCT_URL}/${id}`,'PUT',{[field]:value}); showMessage('Product updated'); loadProducts(currentProductPage);}
    catch(err){showMessage(err.message,'red');}
}

function bulkDeleteProducts(){
    const selected=[...document.querySelectorAll('.product-checkbox:checked')].map(cb=>parseInt(cb.closest('tr').children[1].textContent));
    if(selected.length===0){showMessage('No products selected','red'); return;}
    if(!confirm(`Delete ${selected.length} products?`)) return;
    selected.forEach(id=>deleteProduct(id));
}

productSearch.addEventListener('input',()=>{
    const query=productSearch.value.toLowerCase();
    productTable.querySelectorAll('tr').forEach(row=>{
        const name=row.children[2].textContent.toLowerCase();
        row.style.display=name.includes(query)?'':'none';
    });
});

// --- ORDERS ---
async function loadOrders(page=1){
    currentOrderPage=page;
    let orders=await apiCall(ORDER_URL);
    const sortType=orderSort.value;
    if(sortType==='total-asc') orders.sort((a,b)=>a.quantity*a.product.price-b.quantity*b.product.price);
    else if(sortType==='total-desc') orders.sort((a,b)=>b.quantity*b.product.price-a.quantity*a.product.price);
    else if(sortType==='status') orders.sort((a,b)=>a.status.localeCompare(b.status));
    else orders.sort((a,b)=>b.order_id-a.order_id);

    const start=(page-1)*ITEMS_PER_PAGE;
    const paginated=orders.slice(start,start+ITEMS_PER_PAGE);

    orderTable.innerHTML='';
    let total=0;
    paginated.forEach(o=>{
        const tr=document.createElement('tr');
        let badgeClass=o.status.toLowerCase();
        tr.innerHTML=`
            <td><input type="checkbox" class="order-checkbox"></td>
            <td>${o.order_id}</td>
            <td>${o.product.name}</td>
            <td>${o.quantity}</td>
            <td>₹${o.quantity*o.product.price}</td>
            <td><span class="status-badge ${badgeClass}">${o.status}</span>
                <select onchange="changeStatus(${o.order_id}, this.value)">
                    <option value="Pending" ${o.status==='Pending'?'selected':''}>Pending</option>
                    <option value="Completed" ${o.status==='Completed'?'selected':''}>Completed</option>
                    <option value="Cancelled" ${o.status==='Cancelled'?'selected':''}>Cancelled</option>
                </select>
            </td>
            <td><button onclick="deleteOrder(${o.order_id})">Delete</button></td>
        `;
        orderTable.appendChild(tr);
        total+=o.quantity*o.product.price;
    });
    totalAmountSpan.textContent=total;
    renderPagination(orders.length,page,'orders');
}

async function changeStatus(orderId,newStatus){
    try{await apiCall(`${ORDER_URL}/${orderId}/status`,'PUT',{status:newStatus}); showMessage(`Order #${orderId} status updated to ${newStatus}`); loadOrders(currentOrderPage);}
    catch(err){showMessage(err.message,'red');}
}

async function addOrder(e){e.preventDefault();
    const product_id=parseInt(orderProductSelect.value);
    const quantity=parseInt(document.getElementById('order-quantity').value);
    if(!product_id){showMessage("Select a product","red"); return;}
    if(quantity<=0){showMessage("Quantity must be positive","red"); return;}
    try{await apiCall(ORDER_URL,'POST',{product_id,quantity}); addOrderForm.reset(); showMessage("Order placed successfully"); loadOrders(currentOrderPage);}
    catch(err){showMessage(err.message,'red');}
}

async function deleteOrder(id){if(!confirm('Are you sure you want to delete this order?')) return;
    try{await apiCall(`${ORDER_URL}/${id}`,'DELETE'); showMessage("Order deleted"); loadOrders(currentOrderPage);}
    catch(err){showMessage(err.message,'red');}
}

function filterOrders(status){
    const rows=orderTable.querySelectorAll('tr');
    rows.forEach(row=>{
        const rowStatus=row.children[5].querySelector('select').value;
        row.style.display=(status==='All'||rowStatus===status)?'':'none';
    });
}

function bulkDeleteOrders(){
    const selected=[...document.querySelectorAll('.order-checkbox:checked')].map(cb=>parseInt(cb.closest('tr').children[1].textContent));
    if(selected.length===0){showMessage('No orders selected','red'); return;}
    if(!confirm(`Delete ${selected.length} orders?`)) return;
    selected.forEach(id=>deleteOrder(id));
}

// Event listeners
addProductForm.addEventListener('submit',addProduct);
addOrderForm.addEventListener('submit',addOrder);
orderSort.addEventListener('change',()=>loadOrders(currentOrderPage));

document.getElementById('select-all-products').addEventListener('change',(e)=>{const checked=e.target.checked; document.querySelectorAll('.product-checkbox').forEach(cb=>cb.checked=checked);});
document.getElementById('select-all-orders').addEventListener('change',(e)=>{const checked=e.target.checked; document.querySelectorAll('.order-checkbox').forEach(cb=>cb.checked=checked);});

// Initial load
loadProducts();
loadOrders();
</script>
</body>
</html>



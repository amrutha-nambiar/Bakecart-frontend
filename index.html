<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bakecart Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    body { background:#f5f5f5; font-family:'Roboto',sans-serif; color:#333; padding:20px; }
    h1 { text-align:center; margin-bottom:30px; font-weight:700; color:#2c3e50; }

    .container { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; }
    section { background:#fff; border-radius:8px; padding:20px; box-shadow:0 2px 6px rgba(0,0,0,0.1); flex:1; min-width:300px; max-width:600px; }

    table { width:100%; border-collapse:collapse; margin-bottom:15px; }
    th, td { padding:10px; text-align:left; border-bottom:1px solid #ddd; }
    th { background:#ecf0f1; font-weight:500; }
    tr:hover { background:#f9f9f9; }

    button { background:#3498db; color:#fff; border:none; padding:8px 12px; border-radius:4px; cursor:pointer; transition:0.2s; }
    button:hover { background:#2980b9; }

    input, select { padding:8px; border-radius:4px; border:1px solid #ccc; width:100%; box-sizing:border-box; }
    button[type="submit"] { margin-top:5px; width:fit-content; }

    .message { text-align:center; margin-bottom:15px; font-weight:500; min-height:24px; color:#27ae60; }
    .total { font-weight:600; margin-top:10px; }

    @media (max-width:800px){ .container { flex-direction:column; align-items:center; } }
</style>
</head>
<body>

<h1>üç∞ Bakecart Admin Dashboard</h1>
<div id="message" class="message"></div>

<div class="container">
    <!-- PRODUCTS -->
    <section>
        <h2>Products</h2>
        <table id="product-table">
            <thead>
                <tr><th>ID</th><th>Name</th><th>Price</th><th>Action</th></tr>
            </thead>
            <tbody></tbody>
        </table>

        <h3>Add Product</h3>
        <form id="add-product-form">
            <input type="text" id="product-name" placeholder="Product Name" required>
            <input type="number" id="product-price" placeholder="Product Price" required min="1">
            <button type="submit">Add Product</button>
        </form>
    </section>

    <!-- ORDERS -->
    <section>
        <h2>Orders</h2>
        <table id="order-table">
            <thead>
                <tr><th>Order ID</th><th>Product</th><th>Qty</th><th>Total</th><th>Action</th></tr>
            </thead>
            <tbody></tbody>
        </table>

        <p class="total">Total Amount: $<span id="total-amount">0</span></p>

        <h3>Create Order</h3>
        <form id="add-order-form">
            <select id="order-product-select" required>
                <option value="">Select Product</option>
            </select>
            <input type="number" id="order-quantity" placeholder="Quantity" required min="1">
            <button type="submit">Place Order</button>
        </form>
    </section>
</div>

<script>
const PRODUCT_URL = "https://bakecart-product-service.onrender.com/products";
const ORDER_URL = "https://bakecart-order-service.onrender.com/orders";


const productTable = document.querySelector('#product-table tbody');
const orderTable = document.querySelector('#order-table tbody');
const addProductForm = document.getElementById('add-product-form');
const addOrderForm = document.getElementById('add-order-form');
const orderProductSelect = document.getElementById('order-product-select');
const messageDiv = document.getElementById('message');
const totalAmountSpan = document.getElementById('total-amount');

function showMessage(msg, color='green'){
    messageDiv.textContent = msg;
    messageDiv.style.color = color;
    setTimeout(() => messageDiv.textContent = '', 3000);
}

async function apiCall(url, method='GET', data=null){
    const options = { method, headers:{'Content-Type':'application/json'} };
    if(data) options.body = JSON.stringify(data);
    const res = await fetch(url, options);
    const resData = await res.json();
    if(!res.ok) throw new Error(resData.error || 'API error');
    return resData;
}

// -------- PRODUCTS --------
async function loadProducts(){
    const products = await apiCall(PRODUCT_URL);
    productTable.innerHTML = '';
    products.sort((a,b)=>a.id-b.id).forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.id}</td><td>${p.name}</td><td>$${p.price}</td>
                        <td><button onclick="deleteProduct(${p.id})">Delete</button></td>`;
        productTable.appendChild(tr);
    });
    loadProductOptions(products);
}

async function loadProductOptions(products){
    orderProductSelect.innerHTML = '<option value="">Select Product</option>';
    products.forEach(p=>{
        const option = document.createElement('option');
        option.value=p.id;
        option.textContent=`${p.name} - $${p.price}`;
        orderProductSelect.appendChild(option);
    });
}

async function addProduct(e){
    e.preventDefault();
    const name = document.getElementById('product-name').value.trim();
    const price = parseFloat(document.getElementById('product-price').value);
    if(price<=0){ showMessage("Price must be positive","red"); return; }
    try{
        await apiCall(PRODUCT_URL,'POST',{name,price});
        addProductForm.reset();
        showMessage("Product added successfully");
        loadProducts();
    }catch(err){ showMessage(err.message,"red"); }
}

async function deleteProduct(id){
    try{
        await apiCall(`${PRODUCT_URL}/${id}`,'DELETE');
        showMessage("Product deleted");
        loadProducts();
    }catch(err){ showMessage(err.message,"red"); }
}

// -------- ORDERS --------
async function loadOrders(){
    const orders = await apiCall(ORDER_URL);
    orderTable.innerHTML = '';
    let total = 0;
    orders.sort((a,b)=>b.order_id - a.order_id).forEach(o=>{
        const tr = document.createElement('tr');

        // Color-coded status
        let statusColor = '';
        if(o.status === "Pending") statusColor = '#f1c40f';
        else if(o.status === "Completed") statusColor = '#2ecc71';
        else if(o.status === "Cancelled") statusColor = '#e74c3c';

        // Dropdown for status
        const statusDropdown = `
            <select onchange="changeStatus(${o.order_id}, this.value)" style="padding:3px 5px; border-radius:5px;">
                <option value="Pending" ${o.status==='Pending'?'selected':''}>Pending</option>
                <option value="Completed" ${o.status==='Completed'?'selected':''}>Completed</option>
                <option value="Cancelled" ${o.status==='Cancelled'?'selected':''}>Cancelled</option>
            </select>
        `;

        tr.innerHTML = `
            <td>${o.order_id}</td>
            <td>${o.product.name}</td>
            <td>${o.quantity}</td>
            <td>$${o.quantity * o.product.price}</td>
            <td>${statusDropdown}</td>
            <td><button onclick="deleteOrder(${o.order_id})">Delete</button></td>
        `;
        orderTable.appendChild(tr);
        total += o.quantity * o.product.price;
    });
    totalAmountSpan.textContent = total;
}
async function changeStatus(orderId, newStatus){
    try {
        await apiCall(`${ORDER_URL}/${orderId}/status`, 'PUT', { status: newStatus });
        showMessage(`Order #${orderId} status updated to ${newStatus}`);
        loadOrders(); // refresh table to show correct colors
    } catch(err){
        showMessage(err.message, 'red');
    }
}


async function addOrder(e){
    e.preventDefault();
    const product_id=parseInt(orderProductSelect.value);
    const quantity=parseInt(document.getElementById('order-quantity').value);
    if(!product_id){ showMessage("Select a product","red"); return; }
    if(quantity<=0){ showMessage("Quantity must be positive","red"); return; }
    try{
        await apiCall(ORDER_URL,'POST',{product_id,quantity});
        addOrderForm.reset();
        showMessage("Order placed successfully");
        loadOrders();
    }catch(err){ showMessage(err.message,"red"); }
}

async function deleteOrder(id){
    try{
        await apiCall(`${ORDER_URL}/${id}`,'DELETE');
        showMessage("Order deleted");
        loadOrders();
    }catch(err){ showMessage(err.message,"red"); }
}

addProductForm.addEventListener('submit',addProduct);
addOrderForm.addEventListener('submit',addOrder);

// Initial load
loadProducts();
loadOrders();
</script>
</body>
</html>

